<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVE Analytics - Flow Visualization</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
    <style>
        .sankey-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
        }
        .flow-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
        }
        .metric-flow {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            margin: 10px 0;
            color: white;
            font-weight: bold;
        }
        .flow-critical { background: linear-gradient(135deg, #ff6b6b, #ee5a52); }
        .flow-high { background: linear-gradient(135deg, #ffa726, #ff9800); }
        .flow-medium { background: linear-gradient(135deg, #ffee58, #fdd835); color: #333; }
        .flow-low { background: linear-gradient(135deg, #66bb6a, #4caf50); }
        .flow-none { background: linear-gradient(135deg, #78909c, #607d8b); }
        
        .process-stage {
            position: relative;
            padding: 20px;
            margin: 10px;
            border-radius: 15px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .stage-arrow {
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2rem;
            color: rgba(255,255,255,0.7);
        }
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid p-4">
        <div class="row mb-4">
            <div class="col">
                <h2 class="fw-bold">CVE Processing Flow Analysis</h2>
                <p class="text-muted">Visualizing the vulnerability assessment pipeline</p>
            </div>
        </div>

        <!-- Process Flow Overview -->
        <div class="row mb-4">
            <div class="col">
                <div class="sankey-container">
                    <h4 class="text-center mb-4">CVE Analysis Pipeline</h4>
                    <div class="row align-items-center">
                        <div class="col-md-2">
                            <div class="process-stage text-center">
                                <div class="stage-arrow">→</div>
                                <h5>Discovered</h5>
                                <h2 class="fw-bold">2304</h2>
                                <small>Total CVEs</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="process-stage text-center">
                                <div class="stage-arrow">→</div>
                                <h5>Triaged</h5>
                                <h2 class="fw-bold">11</h2>
                                <small>0.5% processed</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="process-stage text-center">
                                <div class="stage-arrow">→</div>
                                <h5>Analyzed</h5>
                                <h2 class="fw-bold">11</h2>
                                <small>100% of triaged</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="process-stage text-center">
                                <div class="stage-arrow">→</div>
                                <h5>Prioritized</h5>
                                <h2 class="fw-bold">11</h2>
                                <small>Risk assigned</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="process-stage text-center">
                                <div class="stage-arrow">→</div>
                                <h5>Remediated</h5>
                                <h2 class="fw-bold">3</h2>
                                <small>27% fixed</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="process-stage text-center">
                                <h5>Verified</h5>
                                <h2 class="fw-bold">0</h2>
                                <small>Awaiting verification</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sankey Diagram -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">CVE Flow Analysis</h5>
                        <small class="text-muted">Shows the distribution and processing flow of vulnerabilities</small>
                    </div>
                    <div class="card-body">
                        <div id="sankey-chart" style="height: 500px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Priority Distribution Flow -->
        <div class="row mb-4">
            <div class="col-md-2">
                <div class="metric-flow flow-critical">
                    <h6>CRITICAL</h6>
                    <h3>0</h3>
                    <div class="progress bg-white bg-opacity-25 mt-2">
                        <div class="progress-bar bg-white" style="width: 0%"></div>
                    </div>
                    <small>0% of total</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-flow flow-high">
                    <h6>HIGH</h6>
                    <h3>0</h3>
                    <div class="progress bg-white bg-opacity-25 mt-2">
                        <div class="progress-bar bg-white" style="width: 0%"></div>
                    </div>
                    <small>0% of total</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-flow flow-medium">
                    <h6>MEDIUM</h6>
                    <h3>0</h3>
                    <div class="progress bg-white bg-opacity-25 mt-2">
                        <div class="progress-bar bg-dark" style="width: 0%"></div>
                    </div>
                    <small>0% of total</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-flow flow-low">
                    <h6>LOW</h6>
                    <h3>11</h3>
                    <div class="progress bg-white bg-opacity-25 mt-2">
                        <div class="progress-bar bg-white" style="width: 0.5%"></div>
                    </div>
                    <small>0.5% of total</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="metric-flow flow-none">
                    <h6>UNANALYZED</h6>
                    <h3>2293</h3>
                    <div class="progress bg-white bg-opacity-25 mt-2">
                        <div class="progress-bar bg-white" style="width: 99.5%"></div>
                    </div>
                    <small>99.5% of total - BOTTLENECK</small>
                </div>
            </div>
        </div>

        <!-- Analysis Status Flow -->
        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Analysis Status Distribution</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="flow-card p-3 text-center">
                                    <h6 class="text-primary">Not Analyzed</h6>
                                    <h3 class="fw-bold">2293</h3>
                                    <div class="progress">
                                        <div class="progress-bar bg-danger" style="width: 99.5%"></div>
                                    </div>
                                    <small class="text-muted">Critical bottleneck</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="flow-card p-3 text-center">
                                    <h6 class="text-success">Fixed</h6>
                                    <h3 class="fw-bold">3</h3>
                                    <div class="progress">
                                        <div class="progress-bar bg-success" style="width: 0.1%"></div>
                                    </div>
                                    <small class="text-muted">Remediated</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="flow-card p-3 text-center">
                                    <h6 class="text-warning">Rejected</h6>
                                    <h3 class="fw-bold">3</h3>
                                    <div class="progress">
                                        <div class="progress-bar bg-warning" style="width: 0.1%"></div>
                                    </div>
                                    <small class="text-muted">False positives</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="flow-card p-3 text-center">
                                    <h6 class="text-info">Not Affected</h6>
                                    <h3 class="fw-bold">4</h3>
                                    <div class="progress">
                                        <div class="progress-bar bg-info" style="width: 0.2%"></div>
                                    </div>
                                    <small class="text-muted">No action needed</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Create Sankey diagram
        function createSankeyDiagram() {
            const svg = d3.select("#sankey-chart")
                .append("svg")
                .attr("width", "100%")
                .attr("height", 500);
                
            const width = document.getElementById("sankey-chart").offsetWidth;
            const height = 500;
            
            // Sankey data structure
            const data = {
                nodes: [
                    {name: "Total CVEs (2304)"},
                    {name: "Analyzed (11)"},
                    {name: "Unanalyzed (2293)"},
                    {name: "Critical (0)"},
                    {name: "High (0)"},
                    {name: "Medium (0)"},
                    {name: "Low (11)"},
                    {name: "Fixed (3)"},
                    {name: "Rejected (3)"},
                    {name: "Not Affected (4)"},
                    {name: "Pending (1)"}
                ],
                links: [
                    {source: 0, target: 1, value: 11},
                    {source: 0, target: 2, value: 2293},
                    {source: 1, target: 3, value: 0},
                    {source: 1, target: 4, value: 0},
                    {source: 1, target: 5, value: 0},
                    {source: 1, target: 6, value: 11},
                    {source: 6, target: 7, value: 3},
                    {source: 6, target: 8, value: 3},
                    {source: 6, target: 9, value: 4},
                    {source: 6, target: 10, value: 1}
                ]
            };
            
            const sankey = d3.sankey()
                .nodeWidth(15)
                .nodePadding(10)
                .extent([[1, 1], [width - 1, height - 6]]);
                
            const {nodes, links} = sankey(data);
            
            // Color scale
            const color = d3.scaleOrdinal()
                .domain(["Total", "Analyzed", "Unanalyzed", "Critical", "High", "Medium", "Low", "Fixed", "Rejected", "Not Affected", "Pending"])
                .range(["#007bff", "#28a745", "#dc3545", "#ff0000", "#ff6600", "#ffcc00", "#66cc00", "#28a745", "#ffc107", "#17a2b8", "#6c757d"]);
            
            // Create tooltip
            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);
            
            // Add links
            svg.append("g")
                .selectAll("path")
                .data(links)
                .join("path")
                .attr("d", d3.sankeyLinkHorizontal())
                .attr("stroke", d => color(d.source.name.split(" ")[0]))
                .attr("stroke-width", d => Math.max(1, d.width))
                .attr("fill", "none")
                .attr("opacity", 0.6)
                .on("mouseover", function(event, d) {
                    tooltip.transition().duration(200).style("opacity", .9);
                    tooltip.html(`${d.source.name} → ${d.target.name}<br/>Count: ${d.value}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition().duration(500).style("opacity", 0);
                });
            
            // Add nodes
            svg.append("g")
                .selectAll("rect")
                .data(nodes)
                .join("rect")
                .attr("x", d => d.x0)
                .attr("y", d => d.y0)
                .attr("height", d => d.y1 - d.y0)
                .attr("width", d => d.x1 - d.x0)
                .attr("fill", d => color(d.name.split(" ")[0]))
                .attr("stroke", "#000")
                .attr("stroke-width", 0.5)
                .on("mouseover", function(event, d) {
                    tooltip.transition().duration(200).style("opacity", .9);
                    tooltip.html(`${d.name}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition().duration(500).style("opacity", 0);
                });
            
            // Add node labels
            svg.append("g")
                .style("font", "12px sans-serif")
                .selectAll("text")
                .data(nodes)
                .join("text")
                .attr("x", d => d.x0 < width / 2 ? d.x1 + 6 : d.x0 - 6)
                .attr("y", d => (d.y1 + d.y0) / 2)
                .attr("dy", "0.35em")
                .attr("text-anchor", d => d.x0 < width / 2 ? "start" : "end")
                .text(d => d.name)
                .attr("fill", "#333");
        }
        
        // Initialize the diagram when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(createSankeyDiagram, 100);
        });
        
        // Redraw on window resize
        window.addEventListener('resize', function() {
            d3.select("#sankey-chart").select("svg").remove();
            setTimeout(createSankeyDiagram, 100);
        });
    </script>
</body>
</html>
